# docker-compose file
#
# project: crdm-tools
# author: b.briotribeyre@nhs.net
services:
  omop_es:
    env_file: "./omop_es/.env"
    build:
      context: "./omop_es"
      args:
        - "FTP_PROXY=${PROXY}"
        - "HTTP_PROXY=${PROXY}"
        - "HTTPS_PROXY=${PROXY}"
    platform: linux/amd64
    environment:
      - "HTTP_PROXY=${PROXY}"
      - "HTTPS_PROXY=${PROXY}"
      - "OMOP_ES_SETTINGS_ID=${SETTINGS_ID}"
      - "OMOP_ES_BATCHED=${BATCHED}"
      - "OMOP_ES_START_BATCH=${START_BATCH}"
      - "OMOP_ES_EXTRACT_DT=${EXTRACT_DT}"
      - "OMOP_ES_ZIP_OUTPUT=${ZIP_OUTPUT}"
      - "GITHUB_PAT=${GITHUB_PAT}"
    volumes:
      - "./omop_es/local:/share/local"

  omop-cascade:
    env_file: "./omop-cascade/.env"
    build:
      context: "./omop-cascade"
      args:
        - "FTP_PROXY=${PROXY}"
        - "HTTP_PROXY=${PROXY}"
        - "HTTPS_PROXY=${PROXY}"
    platform: linux/amd64
    environment:
      - "HTTP_PROXY=${PROXY}"
      - "HTTPS_PROXY=${PROXY}"
      - "CRDM_ID=${ID}"
      - "GITHUB_PAT=${GITHUB_PAT}"
    volumes:
      - "./omop-cascade/local:/share/local"
